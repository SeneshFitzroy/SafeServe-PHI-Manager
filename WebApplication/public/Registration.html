<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHI Registration</title>
    <link rel="stylesheet" href="css/Navigation.css">
    <link rel="stylesheet" href="css/StyleSheet2.css">
    
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/session-guard.js"></script>
    <script type="module" src="js/nav-access.js"></script>
    <script type="module" src="js/user-info.js"></script>
    <script type="module" src="js/phi-registration.js"></script>
    <script type="module" src="js/phi-listing.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
</head>
<body>
    <div class="navigation">
        <div class="Logo"><img src="images/logo.png" /></div>
        <div class="logoname">Safe Serve</div>
        
        <ul class="nav-menu">
            <a href="Dashboard.html" data-page="Dashboard.html" data-icon="dashboard-icon-b.png">
                <li class="nav-item ">
                    <img src="images/dashboard-icon-b.png" />
                    <span>Dashboard</span>
                </li>
            </a>
            <a href="Calendar.html" data-page="Calendar.html" data-icon="calendar-icon-b.png">
                <li class="nav-item">
                    <img src="images/calendar-icon-b.png" />
                    <span>Calendar</span>
                </li>
            </a>
            <a href="InspectionLog.html" data-page="InspectionLog.html" data-icon="inspectionlog-icon-b.png">
                <li class="nav-item">
                    <img src="images/inspectionlog-icon-b.png" />
                    <span>Inspection Log</span>
                </li>
            </a>
            <a href="Analytics.html" data-page="Analytics.html" data-icon="analytics-icon-b.png">
                <li class="nav-item">
                    <img src="images/analytics-icon-b.png" />
                    <span>Analytics</span>
                </li>
            </a>
            <a href="" data-page="Registration.html" data-icon="registerphi-icon-b.png">
                <li class="nav-item active">
                    <img src="images/registerphi-icon-W.png" />
                    <span>Register PHI</span>
                </li>
            </a>
            <a href="PHIinformation.html"  data-page="PHIinformation.html" data-icon="profile-icon-b.png">
                <li class="nav-item">
                    <img src="images/profile-icon-b.png" />
                    <span>Profile</span>
                </li>
            </a>
        </ul>
        <form method="post" action="">
            <input type="hidden" name="action" value="logout" />
            <button class="logout" onclick="logoutUser(event)">
                <img src="images/logout-icon.png"/>
                <span>Logout</span>
            </button>
        </form>
    </div>

    <div class="search-bar-container">
        <input type="text" class="search-input" placeholder="Type Here.....">
        <button class="search-button">
            <i class="bi bi-search"></i>
        </button>
    </div>
    
    <div class="user-profile">
        <div class="user-avatar">
            <img src="images/logged-user-icon.png">
        </div>
        <div class="user-info">
            <span class="user-name"></span>
            <span class="user-role"></span>
        </div>
    </div>
    
    
    <div class="main-header">PHI Regsitration</div>

    <!--Middle Container-->
    <div class="middle-container">
        <button class="add-button" style="font-size: 15px" onclick="showSlider()">
            <div>+</div>
            <p>Add PHI</p>
        </button>

        <div class="header-container" style="top:60px;">
            <span class="header-top" style="margin-left:20px">PHI ID</span>
            <span class="header-top" style="margin-left:200px">Full Name</span>
            <div class="header-top" style="margin-left:770px">Status</div>
            <div class="header-top" style="margin-left:570px">Phone No</div>                
            <div class="header-top" style="margin-left:955px">Action</div>
        </div>
        
        <div class="content-container" >
            <div class="user">
                <p class="user-id"></p>
                <p class="user-s-name">  </p>
                <p class="user-phone"></p>
                <div class="status">
                    <button class="toggle-btn ${statusClass}" data-uid="${data.uid}" data-status="${statusText}">${statusText}</button>
                </div>
                <div class="user-actions">
                    <!-- view button -->
                    <div class="view" data-uid="${data.uid}">
                        <i class="bi bi-eye-fill"></i>
                    </div>
                    <!-- EDIT button -->
                    <div class="edit" onclick="showEditSlider('${data.uid}')">
                        <i class="bi bi-pencil-fill"></i>
                    </div>
                      
                    <!-- DELETE button -->
                    <div class="delete" data-uid="${data.uid}">
                        <i class="bi bi-trash3-fill"></i>
                    </div>
                </div> 
            </div>
            
        </div>
    </div>





    <!--ADD PHI Slider-->
    <div class="slider" id="addPHISlider">
        <div class="slider-container">
            <div class="slider-header">
                <div class="slider-title">Add New PHI</div>
                <img class="close-slider" src="images/Cancelslide.png" onclick="hideSlider()" />
                <div class="slider-hline">
                    <hr size="2" color="#1F41BB" />
                </div>
            </div>

            <div class="slider-form">
                    <div class="edit-form">
                        <!-- Inside your Add PHI Slider form -->
                        <form id="phi-registration-form">
                            <div class="form-row">
                                <label class="form-label">PHI ID</label>
                                <input class="form-text" type="text" id="phi-id" placeholder="Enter 6-digit PHI ID" required />
                                <div class="error-message" id="phiid-error"></div>
                            </div>
                            <div class="form-row">
                                <label class="form-label">Full Name</label>
                                <input class="form-text" type="text" id="full-name" placeholder="Enter full name" required />
                            </div>
                            <div class="form-row">
                                <label class="form-label">NIC</label>
                                <input class="form-text" type="text" id="nic" placeholder="Enter NIC" required />
                            </div>
                            <div class="form-row">
                                <label class="form-label">Phone Number</label>
                                <input class="form-text" type="text" id="phone" placeholder="Enter phone number" required />
                            </div>
                            <div class="form-row">
                                <label class="form-label">Email</label>
                                <input class="form-text" type="email" id="phi-email" placeholder="Enter email" required />
                            </div>
                            <div class="form-row">
                                <label class="form-label">Personal Address</label>
                                <input class="form-text" type="text" id="personal-address" placeholder="Enter address" required />
                            </div>
                            <div class="form-row">
                                <label class="form-label">Office Location</label>
                                <input class="form-text" type="text" id="office-location" placeholder="Enter office location" required />
                            </div>
                            <div class="form-row">
                                <label class="form-label">District</label>
                                <input class="form-text" type="text" id="district" readonly />
                            </div>
                            <div class="form-row">
                                <label class="form-label">Assigned Grama Niladhari Divisions</label>
                                <div class="multi-select-container">
                                  <div id="add-selected-options" class="selected-options"></div>
                                  <select id="add-multiSelectDropdown">
                                  </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <label class="form-label">Enter New Password</label>
                                <input class="form-text" type="password" id="new-password" placeholder="Enter new password" required />
                            </div>
                            <div class="form-row">
                                <label class="form-label">Confirm Password</label>
                                <input class="form-text" type="password" id="confirm-password" placeholder="Confirm password" required />
                                <div class="error-message" id="password-match-error"></div>
                            </div>
                            <button class="form-save-but" type="submit">Save</button>
                        </form>
                    </div>
            </div>  
        </div>
    </div>



    <!--View PHI Details Slider-->
    <div class="slider" id="viewPHISlider">
        <div class="slider-container">
            <div class="slider-header">
                <div class="slider-title">View PHI Details</div>
                <img class="close-slider" src="images/Cancelslide.png" onclick="hideViewSlider()" />
                <div class="slider-hline">
                    <hr size="2" color="#1F41BB" />
                </div>
            </div>

            <div class="slider-form">
                <form>
                    <div class="edit-form">
                        <div class="form-row">
                            <label class="form-label">PHI ID</label>
                            <input class="form-text" type="text" id="view-phi-id" />
                        </div>
                        <div class="form-row">
                          <label class="form-label">Full Name</label>
                          <input class="form-text" type="text" id="view-full-name" />
                        </div>
                        <div class="form-row">
                          <label class="form-label">NIC</label>
                          <input class="form-text" type="text" id="view-nic" />
                        </div>
                        <div class="form-row">
                          <label class="form-label">Phone Number</label>
                          <input class="form-text" type="text" id="view-phone" />
                        </div>
                        <div class="form-row">
                            <label class="form-label">Email</label>
                            <input class="form-text" type="email" id="view-phi-email" />
                        </div>
                        <div class="form-row">
                            <label class="form-label">Personal Address</label>
                            <input class="form-text" type="text" id="view-personal-address" />
                        </div>
                        <div class="form-row">
                            <label class="form-label">Office Location</label>
                            <input class="form-text" type="text" id="view-office-location" />
                        </div>
                        <div class="form-row">
                            <label class="form-label">District</label>
                            <input class="form-text" type="text" id="view-district" />
                        </div>
                        <div class="form-row">
                            <label class="form-label">Assigned Grama Niladhari Divisions</label>
                            <div class="multi-select-container">
                                <div id="selected-options" class="selected-options"></div>
                            </div>
                        </div>
                        <button class="form-save-but" style="margin-top:0px;" type="submit" onclick="hideViewSlider()">Done</button>
                    </div>
                </form>
            </div>  
        </div>
    </div>



    <!--Edit PHI DetailsSlider-->
    <div class="slider" id="editPHISlider">
        <div class="slider-container">
        <div class="slider-header">
            <div class="slider-title">Edit PHI Details</div>
            <img class="close-slider" src="images/Cancelslide.png" onclick="hideEditSlider()" />
            <div class="slider-hline">
            <hr size="2" color="#1F41BB" />
            </div>
        </div>
    
        <div class="slider-form">
            <form onsubmit="event.preventDefault(); updatePHI();">
            <div class="edit-form">
                <div class="form-row">
                <label class="form-label">District</label>
                <div class="user-role-select">
                    <select id="edit-district">
                    <option value="Colombo">Colombo</option>
                    </select>
                </div>
                </div>
                <div class="form-row">
                <label class="form-label">Assigned Grama Niladhari Divisions</label>
                <div class="multi-select-container">
                    <div id="edit-selected-options" class="selected-options"></div>
                    <select id="edit-multiSelectDropdown">
                    </select>
                </div>
                </div>
                <button class="form-save-but" type="submit">Update</button>
            </div>
            </form>
        </div>  
        </div>
    </div>
  

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <p id="modalText">Are you sure you want to deactivate this PHI account?</p>
            <button id="cancelBtn" class="cancel-btn">Cancel</button>
            <button id="confirmBtn" class="confirm-btn">Confirm</button>
        </div>
    </div>





    <script>
        function logoutUser(e) {
            e.preventDefault(); 
            sessionStorage.clear();
            window.location.href = "login.html";
        }
    
        document.getElementById("cancelBtn").addEventListener("click", function () {
            document.getElementById("confirmModal").style.display = "none";
        });
    
        window.onclick = function (event) {
            let modal = document.getElementById("confirmModal");
            if (event.target === modal) {
                modal.style.display = "none";
            }
        };
    
        function showSlider() {
            document.getElementById('addPHISlider').classList.add('active');
        }
    
        function hideSlider() {
            document.getElementById('addPHISlider').classList.remove('active');
        }
    
        function showEditSlider() {
            document.getElementById('editPHISlider').classList.add('active');
        }
    
        function hideEditSlider() {
            document.getElementById('editPHISlider').classList.remove('active');
        }
    
        function showViewSlider() {
            document.getElementById('viewPHISlider').classList.add('active');
        }
    
        function hideViewSlider() {
            document.getElementById('viewPHISlider').classList.remove('active');
        }
    
        // Shared utility function to add GN division chips
        function addSelectedOption(value, container) {
            if (container.querySelector(`[data-value="${value}"]`)) return;
    
            const optionElement = document.createElement("div");
            optionElement.classList.add("selected-option");
            optionElement.setAttribute("data-value", value);
            optionElement.innerHTML = `${value} <button class="remove-option">&times;</button>`;
    
            container.appendChild(optionElement);
    
            optionElement.querySelector(".remove-option").addEventListener("click", function () {
                container.removeChild(optionElement);
            });
        }
    
        // Add PHI GN dropdown logic
        document.addEventListener("DOMContentLoaded", function () {
            const select = document.getElementById("add-multiSelectDropdown");
            const container = document.getElementById("add-selected-options");
    
            if (select) {
                select.addEventListener("change", function () {
                    const selectedValue = select.value;
                    if (selectedValue) {
                        addSelectedOption(selectedValue, container);
                        select.value = "";
                    }
                });
            }
        });
    
        // Edit PHI GN dropdown logic
        document.addEventListener("DOMContentLoaded", function () {
            const select = document.getElementById("edit-multiSelectDropdown");
            const container = document.getElementById("edit-selected-options");
    
            if (select) {
                select.addEventListener("change", function () {
                    const selectedValue = select.value;
                    if (selectedValue && !container.querySelector(`[data-value="${selectedValue}"]`)) {
                        addSelectedOption(selectedValue, container);
                        select.value = "";
                    }
                });
            }
        });
    </script>
    


</body>
</html>
